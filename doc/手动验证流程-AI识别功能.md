# AI 识别功能手动验证流程

## 验证前准备

### 1. 安装扩展
1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 开启右上角的「开发者模式」
4. 点击「加载已解压的扩展程序」
5. 选择本项目根目录（`website-commiter-extention`）
6. 确认扩展已安装并启用

### 2. 配置 GLM API Key
1. 点击扩展图标，打开弹窗
2. 点击「⚙️ 设置」进入设置页面
3. 切换到「LLM 设置」标签
4. 进行以下配置：
   - **启用 LLM**：开启
   - **提供商**：选择「智谱 GLM」
   - **API Endpoint**：`https://open.bigmodel.cn/api/coding/paas/v4/chat/completions`（默认）
   - **模型**：`glm-4.7`（默认）
   - **API Key**：输入你的智谱 API Key
5. 点击「测试连接」确认配置正确
6. 点击「保存设置」

### 3. 添加测试站点
1. 在设置页面，切换到「站点管理」标签
2. 点击「添加站点」
3. 填写测试站点信息：
   - **网站名称**：如 `测试网站`
   - **网站 URL**：如 `https://example.com`
   - **联系邮箱**：如 `test@example.com`
   - **分类**：如 `AI工具`
   - **标语**：如 `智能测试平台`
   - **简短描述**：如 `这是一个测试网站`
   - **详细描述**：如 `这是测试网站的详细介绍...`
4. 点击「保存」
5. 返回扩展弹窗，在「当前站点」下拉框中选择刚添加的站点

---

## 验证场景

### 场景 1：关键词匹配识别（基准测试）

**目的**：验证原有的关键词匹配功能正常工作

**步骤**：
1. 打开任意导航站提交页面（如 https://navfortech.com/submit）
2. 点击扩展图标打开弹窗
3. 确认「当前站点」已选择
4. 点击「✏️ 自动识别并填充」按钮
5. 观察识别状态和填充结果

**预期结果**：
- 识别状态显示「已完成」
- 可填字段显示识别到的字段数量
- 页面表单字段被填充对应值
- 弹窗显示成功消息，包含填充数量

---

### 场景 2：AI 智能识别（核心功能）

**目的**：验证 AI 识别功能正常工作

**步骤**：
1. 打开一个导航站提交页面
2. 点击扩展图标打开弹窗
3. 确认「当前站点」已选择
4. 确认 LLM 已启用（「🤖 AI 智能识别」按钮可点击）
5. 点击「🤖 AI 智能识别」按钮
6. 观察按钮状态变化：「AI 识别中...」→「填充中...」
7. 等待识别和填充完成

**预期结果**：
- 按钮显示「AI 识别中...」状态
- 约 2-5 秒后识别完成
- 识别状态显示「已完成 (AI)」
- 页面表单字段被正确填充
- 弹窗显示「AI 识别 + 已填充 X 个字段」

---

### 场景 3：缓存机制验证

**目的**：验证同一页面第二次访问时使用缓存

**步骤**：
1. 先执行一次 AI 识别（场景 2）
2. 刷新页面
3. 再次点击「🤖 AI 智能识别」按钮
4. 观察识别速度

**预期结果**：
- 识别几乎是即时完成（使用缓存）
- 识别状态显示「已完成 (缓存)」
- 填充结果与第一次一致

---

### 场景 4：清除缓存功能

**目的**：验证清除缓存后重新识别

**步骤**：
1. 在已完成识别的页面
2. 点击「清除本页识别缓存」链接
3. 确认显示「已清除本页缓存」提示
4. 再次点击「🤖 AI 智能识别」按钮
5. 观察是否重新进行 AI 识别

**预期结果**：
- 清除缓存后识别状态变为「待识别」
- 再次识别时会调用 AI（显示「已完成 (AI)」而非「缓存」）

---

### 场景 5：AI 失败降级

**目的**：验证 AI 识别失败时回退到关键词匹配

**步骤**：
1. 在设置中输入一个无效的 API Key
2. 保存设置
3. 清除当前页面的缓存
4. 点击「🤖 AI 智能识别」按钮
5. 观察行为

**预期结果**：
- 弹窗显示 AI 识别失败的警告
- 系统自动回退到关键词匹配
- 表单仍然被填充（使用关键词匹配结果）
- 识别状态显示「已完成」（非 AI）

---

### 场景 6：未配置 LLM 时的提示

**目的**：验证未配置 LLM 时 AI 按钮状态

**步骤**：
1. 在设置中关闭「启用 LLM」开关
2. 保存设置
3. 返回扩展弹窗
4. 观察「🤖 AI 智能识别」按钮状态

**预期结果**：
- 「🤖 AI 智能识别」按钮显示为禁用状态（灰色）
- 鼠标悬停时显示提示「请在设置中启用 LLM 并配置 GLM API Key」

---

## 控制台日志检查

在验证过程中，可以打开浏览器开发者工具（F12）查看控制台日志：

### Background 日志（Service Worker）
1. 访问 `chrome://extensions/`
2. 找到本扩展，点击「Service Worker」链接
3. 查看 AI 识别相关日志：
   - `[Background] AI 识别请求开始:`
   - `[Background] AI 返回内容:`
   - `[Background] AI 识别完成:`

### Content Script 日志
1. 在目标页面按 F12 打开开发者工具
2. 切换到 Console 标签
3. 查看相关日志：
   - `[NavSubmitter] 尝试 AI 识别...`
   - `[NavSubmitter] 字段识别结果 (ai)`
   - `[NavSubmitter] AI 识别失败，回退到关键词匹配:`（如果失败）

---

## 常见问题排查

### Q1: AI 按钮一直是禁用状态
**排查步骤**：
1. 检查设置中「启用 LLM」是否开启
2. 检查 API Key 是否已填写
3. 刷新扩展弹窗（关闭后重新打开）

### Q2: AI 识别超时
**排查步骤**：
1. 检查网络连接
2. 检查 API Key 是否有效
3. 查看 Service Worker 日志了解具体错误

### Q3: 识别结果不准确
**排查步骤**：
1. 点击「清除本页识别缓存」
2. 重新进行 AI 识别
3. 如果仍不准确，检查表单字段是否有明确的标签和名称

---

## 验证完成检查清单

- [ ] 扩展成功安装并启用
- [ ] GLM API Key 配置正确
- [ ] 测试站点添加成功
- [ ] 关键词匹配识别正常（场景 1）
- [ ] AI 智能识别正常（场景 2）
- [ ] 缓存机制正常（场景 3）
- [ ] 清除缓存功能正常（场景 4）
- [ ] AI 失败降级正常（场景 5）
- [ ] 未配置 LLM 提示正常（场景 6）

---

## 验证日期

- 验证人：__________
- 验证日期：__________
- 验证结果：__________
